




<!-- BEGIN PAGE LEVEL PLUGINS -->
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/select2/js/select2.full.min.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/bootstrap-tagsinput/bootstrap-tagsinput.min.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/typeahead/handlebars.min.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/typeahead/typeahead.bundle.min.js" type="text/javascript"></script>
<script src="https://code.getmdl.io/1.1.3/material.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCMUrYLbYK6ZVvCzXraLrbRa2xEFE8HxEQ&libraries=places&region=IN"></script>
<script src="<?php echo $this->config->item('frontassets'); ?>/js/location/location.js" type="text/javascript"></script>

<div class="scroll-to-top">
    <i class="icon-arrow-up"></i>
</div>
</div>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/js.cookie.min.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
<!-- END CORE PLUGINS -->
<!-- BEGIN PAGE LEVEL PLUGINS -->
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/moment.min.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/bootstrap-daterangepicker/daterangepicker.min.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/morris/morris.min.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/morris/raphael-min.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/counterup/jquery.waypoints.min.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/counterup/jquery.counterup.min.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/amcharts/amcharts/amcharts.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/amcharts/amcharts/serial.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/amcharts/amcharts/pie.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/amcharts/amcharts/radar.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/amcharts/amcharts/themes/light.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/amcharts/amcharts/themes/patterns.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/amcharts/amcharts/themes/chalk.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/amcharts/ammap/ammap.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/amcharts/ammap/maps/js/worldLow.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/amcharts/amstockcharts/amstock.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/fullcalendar/fullcalendar.min.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/horizontal-timeline/horozontal-timeline.min.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/flot/jquery.flot.min.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/flot/jquery.flot.resize.min.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/flot/jquery.flot.categories.min.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/jquery-easypiechart/jquery.easypiechart.min.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/jquery.sparkline.min.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/jqvmap/jqvmap/jquery.vmap.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/jqvmap/jqvmap/maps/jquery.vmap.russia.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/jqvmap/jqvmap/maps/jquery.vmap.world.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/jqvmap/jqvmap/maps/jquery.vmap.europe.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/jqvmap/jqvmap/maps/jquery.vmap.germany.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/jqvmap/jqvmap/maps/jquery.vmap.usa.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/jqvmap/jqvmap/data/jquery.vmap.sampledata.js" type="text/javascript"></script>
<!-- END PAGE LEVEL PLUGINS -->
<!-- BEGIN THEME GLOBAL SCRIPTS -->
<script src="<?= $this->config->item('adminassets'); ?>global/scripts/app.min.js" type="text/javascript"></script>
<!-- END THEME GLOBAL SCRIPTS -->
<!-- BEGIN PAGE LEVEL SCRIPTS -->
<script src="<?= $this->config->item('adminassets'); ?>pages/scripts/dashboard.min.js" type="text/javascript"></script>
<!-- END PAGE LEVEL SCRIPTS -->
<!-- BEGIN THEME LAYOUT SCRIPTS -->
<script src="<?= $this->config->item('adminassets'); ?>layouts/layout2/scripts/layout.min.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>layouts/layout2/scripts/demo.min.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>layouts/global/scripts/quick-sidebar.min.js" type="text/javascript"></script>
<!-- END THEME LAYOUT SCRIPTS -->
<script src="<?= $this->config->item('adminassets') ?>global/scripts/datatable.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets') ?>global/plugins/datatables/datatables.min.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets') ?>global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.js" type="text/javascript"></script>
<!-- END PAGE LEVEL PLUGINS -->
<!-- BEGIN THEME GLOBAL SCRIPTS -->
<script src="<?= $this->config->item('adminassets') ?>global/scripts/app.min.js" type="text/javascript"></script>
<!-- END THEME GLOBAL SCRIPTS -->
<!-- BEGIN PAGE LEVEL SCRIPTS -->
<script src="<?= $this->config->item('adminassets') ?>pages/scripts/table-datatables-colreorder.min.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/bootstrap-modal/js/bootstrap-modalmanager.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets'); ?>global/plugins/bootstrap-modal/js/bootstrap-modal.js" type="text/javascript"></script>
<!-- END PAGE LEVEL PLUGINS -->
<script src="<?= $this->config->item('adminassets') ?>global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets') ?>global/plugins/bootstrap-timepicker/js/bootstrap-timepicker.min.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets') ?>global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js" type="text/javascript"></script>
<script src="<?= $this->config->item('adminassets') ?>global/plugins/bootstrap-fileinput/bootstrap-fileinput.js" type="text/javascript"></script>

<script type="text/javascript">
    function display_error(error_message) { //common function for displayinga ll the error
        'use strict';
        var snackbarContainer = document.querySelector('#toast-notify');
        'use strict';
        var data = {message: error_message};
        snackbarContainer.MaterialSnackbar.showSnackbar(data);
    }
</script>
<script>
    function create_modal(id, question_type) {

        if (document.getElementById('modal_' + id) === null) {

            var content_body = create_response_body(id);
            console.log(content_body);
            var modal_div = document.createElement('div');
            modal_div.className = 'modal fade';
            modal_div.setAttribute('id', 'modal_' + id);
            var modal_header = document.createElement('div');
            modal_header.className = 'modal-header';
            var modal_dimiss_btn = document.createElement('button');
            modal_dimiss_btn.className = 'close';
            modal_dimiss_btn.setAttribute('type', 'button');
            modal_dimiss_btn.setAttribute('data-dismiss', 'modal');
            modal_dimiss_btn.setAttribute('aria-hidden', 'true');
            var modal_title = document.createElement('h4');
            modal_title.className = 'modal-title';
            modal_title.innerHTML = document.getElementById("question_title_" + id).value;
            modal_header.appendChild(modal_dimiss_btn);
            modal_header.appendChild(modal_title);
            var modal_body = document.createElement('div');
            modal_body.className = 'modal-body';
            var modal_body_row = document.createElement('div');
            modal_body_row.className = 'row';
            var modal_footer = document.createElement('div');
            modal_footer.className = 'modal-footer';
            modal_body.appendChild(modal_body_row);
            var modal_close_btn = document.createElement('button');
            modal_close_btn.className = 'btn btn-outline dark';
            modal_close_btn.setAttribute('type', 'button');
            modal_close_btn.setAttribute('id', 'close_modal_btn_' + id);
            modal_close_btn.setAttribute('data-dismiss', 'modal');
            modal_close_btn.setAttribute('aria-hidden', 'true');
            modal_close_btn.innerHTML = "Close";
            var modal_save_btn = document.createElement('button');
            modal_save_btn.className = 'btn btn-outline btn-primary';
            modal_save_btn.setAttribute('type', 'button');
            modal_save_btn.setAttribute('onclick', 'save_response(' + id + ')');
            modal_save_btn.innerHTML = "Save";
            modal_footer.appendChild(modal_save_btn);
            modal_footer.appendChild(modal_close_btn);
            modal_div.appendChild(modal_header);
            modal_div.appendChild(modal_body);
            modal_body.appendChild(modal_body_row);
            modal_body_row.appendChild(content_body);
            modal_div.appendChild(modal_footer);
            document.querySelector('.page-content-wrapper').insertBefore(modal_div, document.getElementById('modals'));
            document.querySelector('#modal_' + id).click();
        } else {
            document.querySelector('#modal_' + id).click();
        }
        //Intializing Elements that requires jquery or javascript after being created
        var question_type = document.querySelector('#question_type_' + id).value;
        var element = document.querySelector('#modal_response_' + id);
        if (question_type == "SCALE") {//Scale Meter
            var slider_init = element.getAttribute('data-init'); //Only Intializing Slider for 1 time not more than 1.
            if (slider_init == 'no') {
                element.setAttribute('data-init', 'yes');
                new Slider('#modal_response_' + id, {});
            }
        } else if (question_type == "DATE") {
            var date_init = element.getAttribute('data-init'); //Only Intializing Slider for 1 time not more than 1.
            if (date_init == 'no') {
                element.setAttribute('data-init', 'yes');
                $('#modal_response_' + id).datepicker();
            }
        } else if (question_type == "TIME") {
            var time_init = element.getAttribute('data-init'); //Only Intializing Slider for 1 time not more than 1.
            if (time_init == 'no') {
                element.setAttribute('data-init', 'yes');
                $('#modal_response_' + id).timepicker();
            }
        }



    }

    function create_response_body(id) {
        var question_type = document.querySelector('#question_type_' + id).value;
        if (question_type == "SUBJECTIVE") {
            return create_response_subjective(id);
        } else if (question_type == "MULTIPLE CHOICE") {
            return create_response_multiple_choice(id);
        } else if (question_type == "NUMERICAL") {
            return create_response_numerical(id);
        } else if (question_type == "DATE") {
            return create_response_date(id);
        } else if (question_type == "TIME") {
            return create_response_time(id);
        } else if (question_type == "PHONE") {
            return create_response_phone(id);
        } else if (question_type == "EMAIL") {
            return create_response_email(id);
        } else if (question_type == "GEO-LOCATION") {
            return create_response_geolocation(id);
        } else if (question_type == "PICTURE/CAMERA INPUT") {
            return create_response_picture(id);
        } else if (question_type == "AUDIO INPUT") {
            return create_response_audio(id);
        } else if (question_type == "SCALE") {
            return create_response_scale(id);
        } else {
            return create_response_subjective(id);
        }

    }

    function create_response_save_options(id) {
        var modal_body_subjective_col = document.createElement('div');
        modal_body_subjective_col.className = 'col-md-12';
        var question_help_text = document.querySelector('#question_help_text_' + id).value;
        var modal_body_subjective_content_label = document.createElement('label');
        modal_body_subjective_content_label.innerHTML = question_help_text;
        var modal_body_subjective_content = document.createElement('input');
        modal_body_subjective_content.className = 'form-control';
        modal_body_subjective_content.setAttribute('id', 'modal_response_' + id);
        modal_body_subjective_content.setAttribute('type', 'text');
        modal_body_subjective_content.setAttribute('placeholder', 'Type your answer');
        modal_body_subjective_col.appendChild(modal_body_subjective_content_label);
        modal_body_subjective_col.appendChild(modal_body_subjective_content);
        return modal_body_subjective_col;
    }

    function create_response_subjective(id) {
        var modal_body_subjective_col = document.createElement('div');
        modal_body_subjective_col.className = 'col-md-12';
        var question_help_text = document.querySelector('#question_help_text_' + id).value;
        var modal_body_subjective_content_label = document.createElement('label');
        modal_body_subjective_content_label.innerHTML = question_help_text;
        var modal_body_subjective_content = document.createElement('input');
        modal_body_subjective_content.className = 'form-control';
        modal_body_subjective_content.setAttribute('id', 'modal_response_' + id);
        modal_body_subjective_content.setAttribute('type', 'text');
        modal_body_subjective_content.setAttribute('placeholder', 'Type your answer');
        modal_body_subjective_col.appendChild(modal_body_subjective_content_label);
        modal_body_subjective_col.appendChild(modal_body_subjective_content);
        return modal_body_subjective_col;
    }

    function create_response_multiple_choice(id) {

        var modal_body_subjective_col = document.createElement('div');
        modal_body_subjective_col.className = 'col-md-12';
        var question_multiple_options = document.querySelector('#question_multiple_options_' + id).value;
        question_multiple_options = question_multiple_options.split("|");
        var question_limit_lower = document.querySelector('#question_limit_lower_' + id).value;
        var question_limit_upper = document.querySelector('#question_limit_upper_' + id).value;
        var modal_body_multiple_choice_checkbox_help_label = document.createElement('label');
        modal_body_multiple_choice_checkbox_help_label.innerHTML = "<b style='color:orange;'>" + question_limit_upper + " out of " + question_multiple_options.length + "</b>";
        var modal_body_multiple_choice_checkbox_list_div = document.createElement('div');
        modal_body_multiple_choice_checkbox_list_div.className = 'mt-checkbox-list';
        for (var i = 0; i < question_multiple_options.length; i++) {

            var modal_body_multiple_choice_checkbox_label = document.createElement('label');
            modal_body_multiple_choice_checkbox_label.className = 'mt-checkbox mt-checkbox-outline';
            var modal_body_multiple_choice_checkbox_input = document.createElement('input');
            modal_body_multiple_choice_checkbox_input.setAttribute('type', 'checkbox');
            modal_body_multiple_choice_checkbox_input.setAttribute('name', 'modal_response_' + id);
            modal_body_multiple_choice_checkbox_input.setAttribute('value', question_multiple_options[i]);
            modal_body_multiple_choice_checkbox_input.setAttribute('onclick', 'multiple_choice_restriction(' + id + ',' + question_limit_upper + ')');
            var checbox_name = document.createTextNode(question_multiple_options[i]);
            var modal_body_multiple_choice_checkbox_span = document.createElement('span');
            modal_body_multiple_choice_checkbox_label.appendChild(modal_body_multiple_choice_checkbox_input);
            modal_body_multiple_choice_checkbox_label.appendChild(checbox_name);
            modal_body_multiple_choice_checkbox_label.appendChild(modal_body_multiple_choice_checkbox_span);
            modal_body_multiple_choice_checkbox_list_div.appendChild(modal_body_multiple_choice_checkbox_label);
        }

        modal_body_subjective_col.appendChild(modal_body_multiple_choice_checkbox_help_label);
        modal_body_subjective_col.appendChild(modal_body_multiple_choice_checkbox_list_div);
        return modal_body_subjective_col;
    }

    function create_response_numerical(id) {

        var modal_body_numerical_col = document.createElement('div');
        modal_body_numerical_col.className = 'col-md-12';
        var question_help_text = document.querySelector('#question_help_text_' + id).value;
        var modal_body_numerical_content_label = document.createElement('label');
        modal_body_numerical_content_label.innerHTML = question_help_text;
        var modal_body_numerical_content = document.createElement('input');
        modal_body_numerical_content.className = 'form-control';
        modal_body_numerical_content.setAttribute('id', 'modal_response_' + id);
        modal_body_numerical_content.setAttribute('type', 'number');
        var upper_limit = document.querySelector('#question_limit_upper_' + id).value;
        modal_body_numerical_content.setAttribute('maxlength', upper_limit);
        modal_body_numerical_content.setAttribute('oninput', 'this.value = this.value.slice(0, this.maxLength)');
        modal_body_numerical_content.setAttribute('placeholder', 'Enter Number , MaxLength ' + upper_limit + ' digit number. ');
        modal_body_numerical_col.appendChild(modal_body_numerical_content_label);
        modal_body_numerical_col.appendChild(modal_body_numerical_content);
        return modal_body_numerical_col;
    }

    function create_response_phone(id) {

        var modal_body_phone_col = document.createElement('div');
        modal_body_phone_col.className = 'col-md-12';
        var question_help_text = document.querySelector('#question_help_text_' + id).value;
        var modal_body_phone_content_label = document.createElement('label');
        modal_body_phone_content_label.innerHTML = question_help_text;
        var modal_body_phone_content = document.createElement('input');
        modal_body_phone_content.className = 'form-control';
        modal_body_phone_content.setAttribute('id', 'modal_response_' + id);
        modal_body_phone_content.setAttribute('type', 'number');
        //var upper_limit = document.querySelector('#question_limit_upper_' + id).value;
        //modal_body_phone_content.setAttribute('maxlength', upper_limit);
        //modal_body_phone_content.setAttribute('oninput', 'this.value = this.value.slice(0, this.maxLength)');
        modal_body_phone_content.setAttribute('placeholder', 'Enter Phone Number.');
        modal_body_phone_col.appendChild(modal_body_phone_content_label);
        modal_body_phone_col.appendChild(modal_body_phone_content);
        return modal_body_phone_col;
    }

    function create_response_email(id) {

        var modal_body_email_col = document.createElement('div');
        modal_body_email_col.className = 'col-md-12';
        var question_help_text = document.querySelector('#question_help_text_' + id).value;
        var modal_body_email_content_label = document.createElement('label');
        modal_body_email_content_label.innerHTML = question_help_text;
        var modal_body_email_content = document.createElement('input');
        modal_body_email_content.className = 'form-control';
        modal_body_email_content.setAttribute('id', 'modal_response_' + id);
        modal_body_email_content.setAttribute('type', 'text');
        modal_body_email_content.setAttribute('oninput', 'validateEmail(' + id + ')');
        modal_body_email_content.setAttribute('placeholder', 'Enter Email Address');
        modal_body_email_content.setAttribute('value', '');
        var modal_body_email_msg_error = document.createElement('span');
        modal_body_email_msg_error.className = 'email-error';
        modal_body_email_msg_error.setAttribute('id', 'email_error_' + id);
        modal_body_email_msg_error.setAttribute('style', 'display: none; color:red;');
        modal_body_email_msg_error.innerHTML = "Not a valid email address";
        var modal_body_email_msg_success = document.createElement('span');
        modal_body_email_msg_success.className = 'email-error';
        modal_body_email_msg_success.setAttribute('id', 'email_success_' + id);
        modal_body_email_msg_success.setAttribute('style', 'display: none; color:green;');
        modal_body_email_msg_success.innerHTML = "A valid email address!";
        var modal_body_email_check = document.createElement('input');
        modal_body_email_check.setAttribute('id', 'modal_email_check_' + id);
        modal_body_email_check.setAttribute('type', 'hidden');
        modal_body_email_check.setAttribute('value', 'wrong');
        modal_body_email_col.appendChild(modal_body_email_content_label);
        modal_body_email_col.appendChild(modal_body_email_content);
        modal_body_email_col.appendChild(modal_body_email_msg_error);
        modal_body_email_col.appendChild(modal_body_email_msg_success);
        modal_body_email_col.appendChild(modal_body_email_check);
        return modal_body_email_col;
    }

    function create_response_date(id) {
        var modal_body_date_col = document.createElement('div');
        modal_body_date_col.className = 'col-md-12';
        var question_help_text = document.querySelector('#question_help_text_' + id).value;
        var modal_body_date_content_label = document.createElement('label');
        modal_body_date_content_label.innerHTML = question_help_text;
        modal_body_date_col.innerHTML = "<div class='input-group date'><input id='modal_response_" + id + "' class='form-control form-control-inline date date-picker' size='16' type'text' value='' data-init='no' /><span class='input-group-btn'><button class='btn default' type='button'><i class='fa fa-calendar'></i></button></span></div>";
        modal_body_date_col.appendChild(modal_body_date_content_label);
        return modal_body_date_col;
    }

    function create_response_time(id) {
        var modal_body_time_col = document.createElement('div');
        modal_body_time_col.className = 'col-md-12';
        var question_help_text = document.querySelector('#question_help_text_' + id).value;
        var modal_body_time_content_label = document.createElement('label');
        modal_body_time_content_label.innerHTML = question_help_text;
        modal_body_time_col.innerHTML = "<div class='input-group'><input id='modal_response_" + id + "' class='form-control form-control-inline itimepicker timepicker-no-seconds' type'text' data-init='no' /><span class='input-group-btn'><button class='btn default' type='button'><i class='fa fa-clock-o'></i></button></span></div>";
        modal_body_time_col.appendChild(modal_body_time_content_label);
        return modal_body_time_col;
    }

    function create_response_picture(id) {

        //var modal_body_picture_col = document.createElement('div');
        var modal_body_picture_col = document.createElement('div');
        modal_body_picture_col.className = 'col-md-12';
        modal_body_picture_col.setAttribute('id', 'media_form_div_' + id);
        var question_help_text = document.querySelector('#question_help_text_' + id).value;
        var modal_body_picture_content_label = document.createElement('label');
        modal_body_picture_content_label.innerHTML = question_help_text;
        modal_body_picture_col.appendChild(modal_body_picture_content_label);
        modal_body_picture_col.innerHTML = "<form enctype='multipart/form-data' method='post' id='mediaForm" + id + "'><div class='col-md-9'>" +
                "<div class='fileinput fileinput-new' data-provides='fileinput'>" +
                "<div class='fileinput-new thumbnail' style='width: 200px; height: 150px;'>" +
                "<img src='http://www.placehold.it/200x150/EFEFEF/AAAAAA&amp;text=no+image' alt='' /> </div>" +
                "<div class='fileinput-preview fileinput-exists thumbnail' style='max-width: 200px; max-height: 150px;'> </div>" +
                "<div>" +
                "<span class='btn default btn-file'>" +
                "<span class='fileinput-new'> Select image </span>" +
                "<span class='fileinput-exists'> <i class='glyphicon glyphicon-folder-open'></i> Change </span>" +
                "<input type='file' name='mediaFile'  id='modal_response_" + id + "'> </span>" +
                "<a href='javascript:;' class='btn red fileinput-exists' data-dismiss='fileinput'><i class='glyphicon glyphicon-trash'></i> <span class='hidden-xs'>Remove</span></a>" +
                "<a href='javascript:;' tabindex='500' class='btn btn-default fileinput-upload fileinput-upload-button fileinput-exists' onclick='image_upload(" + id + ");'><i class='glyphicon glyphicon-upload'></i>  <span class='hidden-xs'>Upload</span></a>" +
                "</div></div></div>" +
                "</form>" +
                "<div class='col-xs-12 col-sm-12 col-md-offset-1 col-md-10' id='media_uploading_icon_" + id + "' style='display:none;'>"
                + "<img class='img-responsive' src='https://media.giphy.com/media/hA9LnXzyZTxmg/giphy.gif'></div>";
        return modal_body_picture_col;
    }
    /**
     function create_response_audio(id) {

     var modal_body_auido_col = document.createElement('div');
     modal_body_auido_col.className = 'col-md-12';
     var question_help_text = document.querySelector('#question_help_text_' + id).value;
     var modal_body_audio_content_label = document.createElement('label');
     modal_body_audio_content_label.innerHTML = question_help_text;
     modal_body_auido_col.appendChild(modal_body_audio_content_label);
     modal_body_auido_col.innerHTML = "<form enctype='multipart/form-data' method='post' id='mediaForm" + id + "'>"
     + "<div id='gUMArea' ><div><input type='radio' name='media' value='video' id='mediaVideo'  hidden>"
     + "<input type='radio' name='media' value='audio' checked='' hidden>"
     + "</div>"
     + "<button class='btn btn-default' onclick='recordaudio(" + id + ")'  type='button' >Initialize Audio</button>"
     + "</div>"
     + "<div id='btns'>"
     + "<button  class='btn btn-default' type='button' id='start'>Start</button>"
     + "<button  class='btn btn-default' type='button' id='stop'>Stop</button>"
     + "</div> <div>"
     + "<ul class='list-unstyled' id='ul'></ul>"
     + "</div>"
     + "</div>"
     + "<div class='col-xs-12 col-sm-12 col-md-offset-1 col-md-10' id='media_uploading_icon_" + id + "' style='display:none;'>"
     + "<img class='img-responsive' src='https://media.giphy.com/media/hA9LnXzyZTxmg/giphy.gif'></div>";
     var script = document.createElement('script');
     script.setAttribute('src', '<?php echo $this->config->item('frontassets'); ?>js/audio/recorder.js');
     modal_body_auido_col.appendChild(script);
     return modal_body_auido_col;
     }
     */
    function create_response_audio(id) {

        var modal_body_auido_col = document.createElement('div');
        modal_body_auido_col.className = 'col-md-12';
        var question_help_text = document.querySelector('#question_help_text_' + id).value;
        var modal_body_audio_content_label = document.createElement('label');
        modal_body_audio_content_label.innerHTML = question_help_text;
        modal_body_auido_col.appendChild(modal_body_audio_content_label);
        modal_body_auido_col.innerHTML = "<form enctype='multipart/form-data' method='post' id='mediaForm" + id + "'>"
                + "<section class='experiment' id='recordrtc_" + id + "'>"
                + "<h2 class='header'>"
                + "<select id='recording-media_" + id + "'> "
                + "<option value='record-audio'>Audio</option>"
                + "</select>"
                + "<select id='media-container-format_" + id + "'> "
                + "<option>WebM</option>"
                + "</select>"

                + "<button id='record_btn_" + id + "' onclick='record(" + id + ");' type='button'>Start Recording</button>"
                + "</h2>"

                + "<div style='text-align: center; display: none;'>"
                + "<button id='upload-to-server_" + id + "' type='button'>Upload To Server</button>"
                + "</div>"

                + "<br>"

                + "<video controls muted></video>"
                + "</section>"
                + "<button class='btn btn-default' id='record_btn_" + id + "' type='button' >Start Recording Audio</button>"
                + "<div class='col-xs-12 col-sm-12 col-md-offset-1 col-md-10' id='media_uploading_icon_" + id + "' style='display:none;'>"
                + "<img class='img-responsive' src='https://media.giphy.com/media/hA9LnXzyZTxmg/giphy.gif'></div>";
        var script = document.createElement('script');
        script.setAttribute('src', 'https://cdn.webrtc-experiment.com/RecordRTC.js');
        var script1 = document.createElement('script');
        script1.setAttribute('src', 'https://cdn.webrtc-experiment.com/gumadapter.js');
        modal_body_auido_col.appendChild(script);
        modal_body_auido_col.appendChild(script1);
        return modal_body_auido_col;
    }


    function create_response_scale(id) {
        var modal_body_scale_col = document.createElement('div');
        modal_body_scale_col.className = 'col-md-12';
        var question_help_text = document.querySelector('#question_help_text_' + id).value;
        var modal_body_scale_content_label = document.createElement('label');
        modal_body_scale_content_label.innerHTML = question_help_text;
        var modal_body_scale_content = document.createElement('input');
        modal_body_scale_content.className = 'slider';
        modal_body_scale_content.setAttribute('id', 'modal_response_' + id);
        modal_body_scale_content.setAttribute('type', 'text');
        modal_body_scale_content.setAttribute('data-slider-id', 'slider');
        modal_body_scale_content.setAttribute('data-slider-min', '0');
        modal_body_scale_content.setAttribute('data-slider-max', '10');
        modal_body_scale_content.setAttribute('data-slider-step', '1');
        modal_body_scale_content.setAttribute('data-slider-value', '0');
        modal_body_scale_content.setAttribute('data-init', 'no');
        modal_body_scale_col.appendChild(modal_body_scale_content_label);
        modal_body_scale_col.appendChild(modal_body_scale_content);
        return modal_body_scale_col;
    }

    function multiple_choice_restriction(id, upperlimit) {
        var maxCheckboxes = upperlimit;
        $('input[name="modal_response_' + id + '"]').change(function () {
            var checkedNum = $('input[name="modal_response_' + id + '"]:checked').length;
            var allCheckoxesChecked = $('input[name="modal_response_' + id + '"]:checked');
            var allCheckboxes = $('input[name="modal_response_' + id + '"]');
            //alert(checkedNum + " - " + maxCheckboxes);

            if (checkedNum == maxCheckboxes) {
                $(allCheckboxes).attr('disabled', 'disabled');
                $(allCheckoxesChecked).removeAttr('disabled');
                $(allCheckoxesChecked).attr('checked', 'checked');
                alert("You have already checked maximum options allowed!");
            } else {
                $(allCheckboxes).removeAttr('disabled');
            }

        });
    }

    function save_response(id) {
        var question_type = document.querySelector('#question_type_' + id).value;
        if (question_type == "SUBJECTIVE") {
            var response = document.querySelector('#modal_response_' + id).value;
            document.querySelector('#response_' + id).value = response;
        } else if (question_type == "MULTIPLE CHOICE") {
            var response = [];
            $('input[name="modal_response_' + id + '"]:checked').each(function () {
                console.log(this.value);
                response.push(this.value);
                response.join('|');
            });
            document.querySelector('#response_' + id).value = response;
        } else if (question_type == "NUMERICAL") {
            var response = document.querySelector('#modal_response_' + id).value;
            document.querySelector('#response_' + id).value = response;
        } else if (question_type == "PHONE") {
            var response = document.querySelector('#modal_response_' + id).value;
            document.querySelector('#response_' + id).value = response;
        } else if (question_type == "GEO-LOCATION") {
            var response = document.querySelector('#modal_response_' + id).value;
            document.querySelector('#response_' + id).value = response;
        } else if (question_type == "EMAIL") {
            var modal_email_check = document.querySelector('#modal_email_check_' + id);
            var response = document.querySelector('#modal_response_' + id).value;
            if (modal_email_check.value == 'correct' && modal_email_check.value != '') {
                document.querySelector('#response_' + id).value = response;
            }
        } else if (question_type == "SCALE") {
            var response = document.querySelector('#modal_response_' + id).value;
            document.querySelector('#response_' + id).value = response;
        } else if (question_type == "DATE") {
            var response = document.querySelector('#modal_response_' + id).value;
            document.querySelector('#response_' + id).value = response;
        } else if (question_type == "TIME") {
            var response = document.querySelector('#modal_response_' + id).value;
            document.querySelector('#response_' + id).value = response;
        }
        if (response != "undefined" && response != '') {
            document.querySelector('#question_' + id + '_badge').className = 'badge badge-success';
        } else {
            display_error("Empty Response , Unable to Save.");
        }
        document.querySelector('#close_modal_btn_' + id).click();
    }

    function exit_question_response() {
        if (confirm("Are you sure? All changes will be lost.") == true) {
            window.location.href = '<?php echo site_url('dashboard'); ?>';
            return false;
        }
    }

    function validate_survey_response() {
        var reponse_invalid_list = [];
        var valid = true;
        var total_question = document.querySelector('#total_question').value;
        for (var i = 1; i <= total_question; i++) {
            var response = document.querySelector('#response_' + i).value;
            if (response == '') {
                reponse_invalid_list.push(i);
                valid = false;
            }
        }
        return valid;
    }

    function isNumber(evt) {
        evt = (evt) ? evt : window.event;
        var charCode = (evt.which) ? evt.which : evt.keyCode;
        if (charCode > 31 && (charCode < 48 || charCode > 57)) {
            display_error("ONLY NUMBERS ARE ALLOWED");
            return false;
        }
        return true;
    }

    function validateEmail(id)
    {
        var enteredEmail = document.querySelector('#modal_response_' + id).value;
        var email_success = document.querySelector('#email_success_' + id);
        var email_error = document.querySelector('#email_error_' + id);
        var modal_email_check = document.querySelector('#modal_email_check_' + id);
        var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        if (re.test(enteredEmail)) {
            modal_email_check.setAttribute('value', 'correct');
            email_error.style.display = 'none';
            email_success.style.display = 'block';
            return true;
        }
        else
        {
            modal_email_check.setAttribute('value', 'wrong');
            email_error.style.display = 'block';
            email_success.style.display = 'none';
            return false;
        }
    }

    function create_response_geolocation(id) {
        var modal_body_subjective_col = document.createElement('div');
        modal_body_subjective_col.className = 'col-md-12';
        var question_help_text = document.querySelector('#question_help_text_' + id).value;
        var modal_body_subjective_content_label = document.createElement('label');
        modal_body_subjective_content_label.innerHTML = question_help_text;
        var modal_body_subjective_content = document.createElement('input');
        modal_body_subjective_content.className = 'form-control';
        modal_body_subjective_content.setAttribute('id', 'modal_response_' + id);
        modal_body_subjective_content.setAttribute('type', 'text');
        modal_body_subjective_content.setAttribute('placeholder', 'Allow to Fetch Location');
        //fetchfill
        var modal_body_geofetchfill = document.createElement('span');
        modal_body_geofetchfill.setAttribute('onclick', 'javascript:fetchfill_location(' + id + ')');
        modal_body_geofetchfill.innerHTML = "FETCH";
        //Input City
        var modal_body_geocity = document.createElement('input');
        modal_body_geocity.setAttribute('id', 'city_' + id);
        modal_body_geocity.setAttribute('type', 'hidden');
        //Input State
        var modal_body_geostate = document.createElement('input');
        modal_body_geostate.setAttribute('id', 'state_' + id);
        modal_body_geostate.setAttribute('type', 'hidden');
        //Input Country
        var modal_body_geocountry = document.createElement('input');
        modal_body_geocountry.setAttribute('id', 'country_' + id);
        modal_body_geocountry.setAttribute('type', 'hidden');
        //Input latitude
        var modal_body_geolatitude = document.createElement('input');
        modal_body_geolatitude.setAttribute('id', 'latitude_' + id);
        modal_body_geolatitude.setAttribute('type', 'hidden');
        //Input longitude
        var modal_body_geolongitude = document.createElement('input');
        modal_body_geolongitude.setAttribute('id', 'longitude_' + id);
        modal_body_geolongitude.setAttribute('type', 'hidden');
        modal_body_subjective_col.appendChild(modal_body_subjective_content_label);
        modal_body_subjective_col.appendChild(modal_body_subjective_content);
        modal_body_subjective_col.appendChild(modal_body_geofetchfill);
        modal_body_subjective_col.appendChild(modal_body_geocity);
        modal_body_subjective_col.appendChild(modal_body_geostate);
        modal_body_subjective_col.appendChild(modal_body_geocountry);
        modal_body_subjective_col.appendChild(modal_body_geolatitude);
        modal_body_subjective_col.appendChild(modal_body_geolongitude);
        return modal_body_subjective_col;
    }

    function image_upload(id) {
        var $file = document.getElementById('modal_response_' + id), $formData = new FormData();
        $formData.append('mediaFile', $file.files[0]);
        $formData.append('response_id', id);
        $formData.append('survey_id', document.getElementById('survey_id').value);
        $formData.append("label", "MEDIAIMAGEUPLOAD");
        //var fd = new FormData(document.getElementById("mediaForm" + id));
        //fd.append('response_id', id);
        //fd.append("label", "MEDIAIMAGEUPLOAD");
        //console.log(fd);
        ajax_image_upload($formData, id);
    }

    function ajax_image_upload($formData, id) {
        $.ajax({
            type: "POST",
            url: "<?php echo site_url('ajax-upload-media'); ?>",
            data: $formData,
            enctype: "multipart/form-data",
            contentType: false,
            cache: false,
            processData: false,
            beforeSend: function (x) {
                document.getElementById('mediaForm' + id).style.display = 'none';
                document.getElementById('media_uploading_icon_' + id).style.display = 'block';
            },
            complete: function (data)
            {
                document.getElementById('mediaForm' + id).style.display = 'block';
                document.getElementById('media_uploading_icon_' + id).style.display = 'none';
                var result = JSON.parse(data.responseText);
                console.log(result);
            }
        });
    }

    function audio_upload(id) {
        blob = new Blob(chunks, {type: media.type}), url = URL.createObjectURL(blob);
        console.log(url);
        data = new FormData();
        data.append('mediaFile', blob);
        data.append('response_id', id);
        data.append('survey_id', document.getElementById('survey_id').value);
        data.append("label", "MEDIAAUDIOUPLOAD");
        ajax_audio_upload(data, id);
    }

    function ajax_audio_upload($formData, id) {
        $.ajax({
            type: "POST",
            url: "<?php echo site_url('ajax-upload-media'); ?>",
            data: $formData,
            enctype: "multipart/form-data",
            contentType: false,
            cache: false,
            processData: false,
            beforeSend: function (x) {
                document.getElementById('mediaForm' + id).style.display = 'none';
                document.getElementById('media_uploading_icon_' + id).style.display = 'block';
            },
            complete: function (data)
            {
                document.getElementById('mediaForm' + id).style.display = 'block';
                document.getElementById('media_uploading_icon_' + id).style.display = 'none';
                var result = JSON.parse(data.responseText);
                console.log(result);
            }
        });
    }

</script>
<script>
    function fetchfill_location(id) {
        get_position(function (position) {
            var x = position.coords.latitude;
            var y = position.coords.longitude;
            get_location(x, y, function (location) {
                var loc = parse_location(x, y, location);
                if (loc.address != null) {
                    document.getElementById('modal_response_' + id).value = loc.address;
                } else {
                    document.getElementById('modal_response_' + id).value = loc.city + "," + loc.state + "," + loc.country;
                }
                document.getElementById('city_' + id).value = loc.city;
                document.getElementById('state_' + id).value = loc.state;
                document.getElementById('country_' + id).value = loc.country;
                document.getElementById('longitude_' + id).value = loc.longitude;
                document.getElementById('latitude_' + id).value = loc.latitude;
            });
        });
    }
    //google.maps.event.addDomListener(window, 'load', attach_location_search);
    function attach_location_search(id) {
        //initial location fetching
        fetchfill_location(id);
        //attaching the input field
        var input = document.getElementById('modal_response_' + id);
        var autocomplete = new google.maps.places.Autocomplete(input);
        autocomplete.addListener('place_changed', function () {
            var place = autocomplete.getPlace();
            var x = place.geometry.location.lat();
            var y = place.geometry.location.lng();
            var loc = parse_location(x, y, place);
            document.getElementById('city_' + id).value = loc.city;
            document.getElementById('state_' + id).value = loc.state;
            document.getElementById('country_' + id).value = loc.country;
            document.getElementById('longitude_' + id).value = loc.longitude;
            document.getElementById('latitude_' + id).value = loc.latitude;
        });
    }
</script>





<script>
    (function () {
        var params = {},
                r = /([^&=]+)=?([^&]*)/g;
        function d(s) {
            return decodeURIComponent(s.replace(/\+/g, ' '));
        }

        var match, search = window.location.search;
        while (match = r.exec(search.substring(1))) {
            params[d(match[1])] = d(match[2]);
            if (d(match[2]) === 'true' || d(match[2]) === 'false') {
                params[d(match[1])] = d(match[2]) === 'true' ? true : false;
            }
        }

        window.params = params;
    })();</script>


<script>

    function record(id) {
        alert(id);
        var recordingDIV = document.querySelector('#recordrtc_' + id);
        var recordingMedia = recordingDIV.querySelector('#recording-media_' + id);
        var recordingPlayer = recordingDIV.querySelector('video');
        var mediaContainerFormat = recordingDIV.querySelector('#media-container-format_' + id);
        var button = recordingDIV.querySelector('#record_btn_' + id);
        if (button.innerHTML === 'Stop Recording') {
            button.disabled = true;
            button.disableStateWaiting = true;
            setTimeout(function () {
                button.disabled = false;
                button.disableStateWaiting = false;
            }, 2 * 1000);
            button.innerHTML = 'Star Recording';
            function stopStream() {
                if (button.stream && button.stream.stop) {
                    button.stream.stop();
                    button.stream = null;
                }
            }

            if (button.recordRTC) {
                if (button.recordRTC.length) {
                    button.recordRTC[0].stopRecording(function (url) {
                        if (!button.recordRTC[1]) {
                            button.recordingEndedCallback(url);
                            stopStream();
                            saveToDiskOrOpenNewTab(button.recordRTC[0], id);
                            return;
                        }

                        button.recordRTC[1].stopRecording(function (url) {
                            button.recordingEndedCallback(url);
                            stopStream();
                        });
                    });
                }
                else {
                    button.recordRTC.stopRecording(function (url) {
                        button.recordingEndedCallback(url);
                        stopStream();
                        saveToDiskOrOpenNewTab(button.recordRTC, id);
                    });
                }
            }

            return;
        }

        button.disabled = true;
        var commonConfig = {
            onMediaCaptured: function (stream) {
                button.stream = stream;
                if (button.mediaCapturedCallback) {
                    button.mediaCapturedCallback();
                }

                button.innerHTML = 'Stop Recording';
                button.disabled = false;
            },
            onMediaStopped: function () {
                button.innerHTML = 'Start Recording';
                if (!button.disableStateWaiting) {
                    button.disabled = false;
                }
            },
            onMediaCapturingFailed: function (error) {
                if (error.name === 'PermissionDeniedError' && !!navigator.mozGetUserMedia) {
                    InstallTrigger.install({
                        'Foo': {
                            // https://addons.mozilla.org/firefox/downloads/latest/655146/addon-655146-latest.xpi?src=dp-btn-primary
                            URL: 'https://addons.mozilla.org/en-US/firefox/addon/enable-screen-capturing/',
                            toString: function () {
                                return this.URL;
                            }
                        }
                    });
                }

                commonConfig.onMediaStopped();
            }
        };
        if (recordingMedia.value === 'record-video') {
            captureVideo(commonConfig);
            button.mediaCapturedCallback = function () {
                button.recordRTC = RecordRTC(button.stream, {
                    type: mediaContainerFormat.value === 'Gif' ? 'gif' : 'video',
                    disableLogs: params.disableLogs || false,
                    canvas: {
                        width: params.canvas_width || 320,
                        height: params.canvas_height || 240
                    },
                    frameInterval: typeof params.frameInterval !== 'undefined' ? parseInt(params.frameInterval) : 20 // minimum time between pushing frames to Whammy (in milliseconds)
                });
                button.recordingEndedCallback = function (url) {
                    recordingPlayer.src = null;
                    recordingPlayer.srcObject = null;
                    if (mediaContainerFormat.value === 'Gif') {
                        recordingPlayer.pause();
                        recordingPlayer.poster = url;
                        recordingPlayer.onended = function () {
                            recordingPlayer.pause();
                            recordingPlayer.poster = URL.createObjectURL(button.recordRTC.blob);
                        };
                        return;
                    }

                    recordingPlayer.src = url;
                    recordingPlayer.play();
                    recordingPlayer.onended = function () {
                        recordingPlayer.pause();
                        recordingPlayer.src = URL.createObjectURL(button.recordRTC.blob);
                    };
                };
                button.recordRTC.startRecording();
            };
        }

        if (recordingMedia.value === 'record-audio') {
            captureAudio(commonConfig, id);
            button.mediaCapturedCallback = function () {
                button.recordRTC = RecordRTC(button.stream, {
                    type: 'audio',
                    bufferSize: typeof params.bufferSize == 'undefined' ? 0 : parseInt(params.bufferSize),
                    sampleRate: typeof params.sampleRate == 'undefined' ? 44100 : parseInt(params.sampleRate),
                    leftChannel: params.leftChannel || false,
                    disableLogs: params.disableLogs || false,
                    recorderType: webrtcDetectedBrowser === 'edge' ? StereoAudioRecorder : null
                });
                button.recordingEndedCallback = function (url) {
                    var audio = new Audio();
                    audio.src = url;
                    audio.controls = true;
                    recordingPlayer.parentNode.appendChild(document.createElement('hr'));
                    recordingPlayer.parentNode.appendChild(audio);
                    if (audio.paused)
                        audio.play();
                    audio.onended = function () {
                        audio.pause();
                        audio.src = URL.createObjectURL(button.recordRTC.blob);
                    };
                };
                button.recordRTC.startRecording();
            };
        }

        if (recordingMedia.value === 'record-audio-plus-video') {
            captureAudioPlusVideo(commonConfig);
            button.mediaCapturedCallback = function () {

                if (webrtcDetectedBrowser !== 'firefox') { // opera or chrome etc.
                    button.recordRTC = [];
                    if (!params.bufferSize) {
                        // it fixes audio issues whilst recording 720p
                        params.bufferSize = 16384;
                    }

                    var audioRecorder = RecordRTC(button.stream, {
                        type: 'audio',
                        bufferSize: typeof params.bufferSize == 'undefined' ? 0 : parseInt(params.bufferSize),
                        sampleRate: typeof params.sampleRate == 'undefined' ? 44100 : parseInt(params.sampleRate),
                        leftChannel: params.leftChannel || false,
                        disableLogs: params.disableLogs || false,
                        recorderType: webrtcDetectedBrowser === 'edge' ? StereoAudioRecorder : null
                    });
                    var videoRecorder = RecordRTC(button.stream, {
                        type: 'video',
                        disableLogs: params.disableLogs || false,
                        canvas: {
                            width: params.canvas_width || 320,
                            height: params.canvas_height || 240
                        },
                        frameInterval: typeof params.frameInterval !== 'undefined' ? parseInt(params.frameInterval) : 20 // minimum time between pushing frames to Whammy (in milliseconds)
                    });
                    // to sync audio/video playbacks in browser!
                    videoRecorder.initRecorder(function () {
                        audioRecorder.initRecorder(function () {
                            audioRecorder.startRecording();
                            videoRecorder.startRecording();
                        });
                    });
                    button.recordRTC.push(audioRecorder, videoRecorder);
                    button.recordingEndedCallback = function () {
                        var audio = new Audio();
                        audio.src = audioRecorder.toURL();
                        audio.controls = true;
                        audio.autoplay = true;
                        audio.onloadedmetadata = function () {
                            recordingPlayer.src = videoRecorder.toURL();
                            recordingPlayer.play();
                        };
                        recordingPlayer.parentNode.appendChild(document.createElement('hr'));
                        recordingPlayer.parentNode.appendChild(audio);
                        if (audio.paused)
                            audio.play();
                    };
                    return;
                }

                button.recordRTC = RecordRTC(button.stream, {
                    type: 'video',
                    disableLogs: params.disableLogs || false,
                    // we can't pass bitrates or framerates here
                    // Firefox MediaRecorder API lakes these features
                });
                button.recordingEndedCallback = function (url) {
                    recordingPlayer.srcObject = null;
                    recordingPlayer.muted = false;
                    recordingPlayer.src = url;
                    recordingPlayer.play();
                    recordingPlayer.onended = function () {
                        recordingPlayer.pause();
                        recordingPlayer.src = URL.createObjectURL(button.recordRTC.blob);
                    };
                };
                button.recordRTC.startRecording();
            };
        }

        if (recordingMedia.value === 'record-screen') {
            captureScreen(commonConfig);
            button.mediaCapturedCallback = function () {
                button.recordRTC = RecordRTC(button.stream, {
                    type: mediaContainerFormat.value === 'Gif' ? 'gif' : 'video',
                    disableLogs: params.disableLogs || false,
                    canvas: {
                        width: params.canvas_width || 320,
                        height: params.canvas_height || 240
                    }
                });
                button.recordingEndedCallback = function (url) {
                    recordingPlayer.src = null;
                    recordingPlayer.srcObject = null;
                    if (mediaContainerFormat.value === 'Gif') {
                        recordingPlayer.pause();
                        recordingPlayer.poster = url;
                        recordingPlayer.onended = function () {
                            recordingPlayer.pause();
                            recordingPlayer.poster = URL.createObjectURL(button.recordRTC.blob);
                        };
                        return;
                    }

                    recordingPlayer.src = url;
                    recordingPlayer.play();
                };
                button.recordRTC.startRecording();
            };
        }

        if (recordingMedia.value === 'record-audio-plus-screen') {
            captureAudioPlusScreen(commonConfig);
            button.mediaCapturedCallback = function () {
                button.recordRTC = RecordRTC(button.stream, {
                    type: 'video',
                    disableLogs: params.disableLogs || false,
                    // we can't pass bitrates or framerates here
                    // Firefox MediaRecorder API lakes these features
                });
                button.recordingEndedCallback = function (url) {
                    recordingPlayer.srcObject = null;
                    recordingPlayer.muted = false;
                    recordingPlayer.src = url;
                    recordingPlayer.play();
                    recordingPlayer.onended = function () {
                        recordingPlayer.pause();
                        recordingPlayer.src = URL.createObjectURL(button.recordRTC.blob);
                    };
                };
                button.recordRTC.startRecording();
            };
        }
    }


    function captureVideo(config) {
        captureUserMedia({video: true}, function (videoStream) {
            recordingPlayer.srcObject = videoStream;
            recordingPlayer.play();
            config.onMediaCaptured(videoStream);
            videoStream.onended = function () {
                config.onMediaStopped();
            };
        }, function (error) {
            config.onMediaCapturingFailed(error);
        });
    }

    function captureAudio(config, id) {
        alert(id);
        var recordingDIV = document.querySelector('#recordrtc_' + id);
        var recordingMedia = recordingDIV.querySelector('#recording-media_' + id);
        var recordingPlayer = recordingDIV.querySelector('video');
        var mediaContainerFormat = recordingDIV.querySelector('#media-container-format_' + id);
        var button = recordingDIV.querySelector('#record_btn_' + id);
        captureUserMedia({audio: true}, function (audioStream) {
            recordingPlayer.srcObject = audioStream;
            recordingPlayer.play();
            config.onMediaCaptured(audioStream);
            audioStream.onended = function () {
                config.onMediaStopped();
            };
        }, function (error) {
            config.onMediaCapturingFailed(error);
        });
    }

    function captureAudioPlusVideo(config) {
        captureUserMedia({video: true, audio: true}, function (audioVideoStream) {
            recordingPlayer.srcObject = audioVideoStream;
            recordingPlayer.play();
            config.onMediaCaptured(audioVideoStream);
            audioVideoStream.onended = function () {
                config.onMediaStopped();
            };
        }, function (error) {
            config.onMediaCapturingFailed(error);
        });
    }

    function captureScreen(config) {
        getScreenId(function (error, sourceId, screenConstraints) {
            if (error === 'not-installed') {
                document.write('<h1><a target="_blank" href="https://chrome.google.com/webstore/detail/screen-capturing/ajhifddimkapgcifgcodmmfdlknahffk">Please install this chrome extension then reload the page.</a></h1>');
            }

            if (error === 'permission-denied') {
                alert('Screen capturing permission is denied.');
            }

            if (error === 'installed-disabled') {
                alert('Please enable chrome screen capturing extension.');
            }

            if (error) {
                config.onMediaCapturingFailed(error);
                return;
            }

            captureUserMedia(screenConstraints, function (screenStream) {
                recordingPlayer.srcObject = screenStream;
                recordingPlayer.play();
                config.onMediaCaptured(screenStream);
                screenStream.onended = function () {
                    config.onMediaStopped();
                };
            }, function (error) {
                config.onMediaCapturingFailed(error);
            });
        });
    }

    function captureAudioPlusScreen(config) {
        getScreenId(function (error, sourceId, screenConstraints) {
            if (error === 'not-installed') {
                document.write('<h1><a target="_blank" href="https://chrome.google.com/webstore/detail/screen-capturing/ajhifddimkapgcifgcodmmfdlknahffk">Please install this chrome extension then reload the page.</a></h1>');
            }

            if (error === 'permission-denied') {
                alert('Screen capturing permission is denied.');
            }

            if (error === 'installed-disabled') {
                alert('Please enable chrome screen capturing extension.');
            }

            if (error) {
                config.onMediaCapturingFailed(error);
                return;
            }

            screenConstraints.audio = true;
            captureUserMedia(screenConstraints, function (screenStream) {
                recordingPlayer.srcObject = screenStream;
                recordingPlayer.play();
                config.onMediaCaptured(screenStream);
                screenStream.onended = function () {
                    config.onMediaStopped();
                };
            }, function (error) {
                config.onMediaCapturingFailed(error);
            });
        });
    }

    function captureUserMedia(mediaConstraints, successCallback, errorCallback) {
        navigator.mediaDevices.getUserMedia(mediaConstraints).then(successCallback).catch(errorCallback);
    }

    function setMediaContainerFormat(arrayOfOptionsSupported) {
        var options = Array.prototype.slice.call(
                mediaContainerFormat.querySelectorAll('option')
                );
        var selectedItem;
        options.forEach(function (option) {
            option.disabled = true;
            if (arrayOfOptionsSupported.indexOf(option.value) !== -1) {
                option.disabled = false;
                if (!selectedItem) {
                    option.selected = true;
                    selectedItem = option;
                }
            }
        });
    }

    recordingMedia.onchange = function () {
        if (this.value === 'record-audio') {
            setMediaContainerFormat(['WAV', 'Ogg']);
            return;
        }
        setMediaContainerFormat(['WebM', /*'Mp4',*/ 'Gif']);
    };
    if (webrtcDetectedBrowser === 'edge') {
        // webp isn't supported in Microsoft Edge
        // neither MediaRecorder API
        // so lets disable both video/screen recording options

        console.warn('Neither MediaRecorder API nor webp is supported in Microsoft Edge. You cam merely record audio.');
        recordingMedia.innerHTML = '<option value="record-audio">Audio</option>';
        setMediaContainerFormat(['WAV']);
    }

    if (webrtcDetectedBrowser === 'firefox') {
        // Firefox implemented both MediaRecorder API as well as WebAudio API
        // Their MediaRecorder implementation supports both audio/video recording in single container format
        // Remember, we can't currently pass bit-rates or frame-rates values over MediaRecorder API (their implementation lakes these features)

        recordingMedia.innerHTML = '<option value="record-audio-plus-video">Audio+Video</option>'
                + '<option value="record-audio-plus-screen">Audio+Screen</option>'
                + recordingMedia.innerHTML;
    }

    // disabling this option because currently this demo
    // doesn't supports publishing two blobs.
    // todo: add support of uploading both WAV/WebM to server.
    if (false && webrtcDetectedBrowser === 'chrome') {
        recordingMedia.innerHTML = '<option value="record-audio-plus-video">Audio+Video</option>'
                + recordingMedia.innerHTML;
        console.info('This RecordRTC demo merely tries to playback recorded audio/video sync inside the browser. It still generates two separate files (WAV/WebM).');
    }

    function saveToDiskOrOpenNewTab(recordRTC, id) {
        var recordingDIV = document.querySelector('#recordrtc_' + id);
        recordingDIV.querySelector('#upload-to-server_' + id).parentNode.style.display = 'block';
        recordingDIV.querySelector('#upload-to-server_' + id).disabled = false;
        recordingDIV.querySelector('#upload-to-server_' + id).onclick = function () {
            if (!recordRTC)
                return alert('No recording found.');
            this.disabled = true;
            var button = this;
            uploadToServer(recordRTC, id, function (progress, fileURL) {
                if (progress === 'ended') {
                    button.disabled = false;
                    button.innerHTML = 'Click to download from server';
                    button.onclick = function () {
                        window.open(fileURL);
                    };
                    return;
                }
                button.innerHTML = progress;
            });
        };
    }

    var listOfFilesUploaded = [];
    function uploadToServer(recordRTC, id, callback) {
        var blob = recordRTC instanceof Blob ? recordRTC : recordRTC.blob;
        var fileType = blob.type.split('/')[0] || 'audio';
        var fileName = (Math.random() * 1000).toString().replace('.', '');
        if (fileType === 'audio') {
            fileName += '.' + (!!navigator.mozGetUserMedia ? 'ogg' : 'wav');
        } else {
            fileName += '.webm';
        }

        // create FormData
        var formData = new FormData();
        formData.append(fileType + '-filename', fileName);
        formData.append(fileType + '-blob', blob);
        formData.append('response_id', id);
        //formData.append('survey_id', document.getElementById('survey_id').value);
        formData.append("label", "MEDIAAUDIOUPLOAD");
        callback('Uploading ' + fileType + ' recording to server.');
        makeXMLHttpRequest('<?php echo site_url('ajax-upload-media'); ?>', formData, function (progress) {
            if (progress !== 'upload-ended') {
                callback(progress);
                return;
            }

            var initialURL = location.href.replace(location.href.split('/').pop(), '') + 'uploads/';
            callback('ended', initialURL + fileName);
            // to make sure we can delete as soon as visitor leaves
            listOfFilesUploaded.push(initialURL + fileName);
        });
    }

    function makeXMLHttpRequest(url, data, callback) {
        var request = new XMLHttpRequest();
        request.onreadystatechange = function () {
            if (request.readyState == 4 && request.status == 200) {
                callback('upload-ended');
            }
        };
        request.upload.onloadstart = function () {
            callback('Upload started...');
        };
        request.upload.onprogress = function (event) {
            callback('Upload Progress ' + Math.round(event.loaded / event.total * 100) + "%");
        };
        request.upload.onload = function () {
            callback('progress-about-to-end');
        };
        request.upload.onload = function () {
            callback('progress-ended');
        };
        request.upload.onerror = function (error) {
            callback('Failed to upload to server');
            console.error('XMLHttpRequest failed', error);
        };
        request.upload.onabort = function (error) {
            callback('Upload aborted.');
            console.error('XMLHttpRequest aborted', error);
        };
        request.open('POST', url);
        request.send(data);
    }

    window.onbeforeunload = function () {
        recordingDIV.querySelector('button').disabled = false;
        recordingMedia.disabled = false;
        mediaContainerFormat.disabled = false;
        if (!listOfFilesUploaded.length)
            return;
        listOfFilesUploaded.forEach(function (fileURL) {
            var request = new XMLHttpRequest();
            request.onreadystatechange = function () {
                if (request.readyState == 4 && request.status == 200) {
                    if (this.responseText === ' problem deleting files.') {
                        alert('Failed to delete ' + fileURL + ' from the server.');
                        return;
                    }

                    listOfFilesUploaded = [];
                    alert('You can leave now. Your files are removed from the server.');
                }
            };
            request.open('POST', 'delete.php');
            var formData = new FormData();
            formData.append('delete-file', fileURL.split('/').pop());
            request.send(formData);
        });
        return 'Please wait few seconds before your recordings are deleted from the server.';
    };
</script>



</html>